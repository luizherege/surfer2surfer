<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Surfer 2 Surfer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="jquery-mobile/styles/high-contrast.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="jquery-mobile/styles/jquery.mobile.structure-1.4.0.min.css" />
    <link href="styles/main.css" rel="stylesheet" />

    <script src="cordova.js" type="text/javascript"></script>
    <script src="jquery-mobile/js/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="jquery-mobile/js/jquery.mobile-1.4.0.min.js" type="text/javascript"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true"></script>

    <script src="scripts/login.js" type="text/javascript"></script>
    <script src="scripts/location.js" type="text/javascript"></script>
</head>
<body>
    
    <div data-role="page" id="box_estados_pg">
        <div data-role="header">
        	<h1>Estados</h1>
            <!-- Aqui ficará a logo futuramente  -->
        </div>
        
        <div id="box_estados" data-role="content">
            <!-- Aqui entram os estados -->
        </div>
        
  	 <div data-role="collapsible-set">

		<div data-role="collapsible" data-collapsed="false">
        <h3>Section 1<label>Numero</label></h3>
        <p>I'm the collapsible set content for section 1.</p>
        </div>
        
        <div data-role="collapsible">
        <h3>Section 2</h3>
        <p>I'm the collapsible set content for section 2.</p>
        </div>
        
    </div>
        
        <div data-role="footer">
        	<h1>Surfer 2 Surfer</h1>
        </div>
    </div>
    
    <script>
        var estados;
        var cidades;
        var notas;
        
        /*função para receber o json do servidor */
        function estados_receiver( array_estados )
        {
            for ( var i = 0; i < array_estados.length; i++ )
            {
                var estado = document.createElement( "a" );
                var estado_txt = document.createTextNode( array_estados[i].nome_estado );
                
                estado.appendChild( estado_txt );
                
                estado.className = "estado";
               
                estado.setAttribute( "id", "estado_" + array_estados[i].id_estado );
                
                estado.setAttribute( "data-role", "button" );
               
                
                document.getElementById( "box_estados" ).appendChild( estado );
            }
			
			estados = array_estados;
        };
        
        /*função para receber o json do servidor */
        function notas_receiver( array_notas )
        {			
			notas = array_notas;
        };
        
        /* função para receber o json do servidor */
        function cidades_receiver( array_cidades )
        {
            for ( var x = 0 ; x < estados.length; x++ )
            {
             	var page = document.createElement( "div" );
                var page_header_div = document.createElement( "div" );
                var page_content = document.createElement( "div" );
                var page_footer_div = document.createElement( "div" );
                var page_header = document.createElement( "header" );
                var page_footer = document.createElement( "header" );
                var page_footer_txt = document.createTextNode( "Surfer 2 Surfer" );
				var page_header_txt = document.createTextNode( estados[x].nome_estado );
                
                page.appendChild( page_header_div );
                page.appendChild( page_content );
                page.appendChild( page_footer_div );
                page_header_div.appendChild( page_header );
                page_footer_div.appendChild( page_footer );
                page_footer.appendChild( page_footer_txt );
				page_header.appendChild( page_header_txt );
                
                page.setAttribute( "data-role", "page" );
                page.setAttribute( "id", "cidades_box_" + estados[x].id_estado  );
                page_content.setAttribute( "data-role", "content" );
                page_content.setAttribute( "id", "cidades_" + estados[x].id_estado );
                page_header_div.setAttribute( "data-role", "header" );
                page_footer_div.setAttribute( "data-role", "header" );
           
            
                document.body.appendChild( page ); 
                
                for ( var i = 0; i < array_cidades.length; i++ )
                { 
					if( array_cidades[i].id_estado > estados[x].id_estado )
					{
						break;
					}
					
					else if( array_cidades[i].id_estado < estados[x].id_estado )
					{
						continue;
					}
					
					else
					{
						var cidade = document.createElement( "a" );
						var cidade_txt = document.createTextNode( array_cidades[i].nome_cidade );
						
						cidade.appendChild( cidade_txt );
		 
						cidade.className = "cidade";
							
						cidade.setAttribute( "data-role", "button" );
                        cidade.setAttribute( "id", "cidade_" + array_cidades[i].id_cidade );
						
						document.getElementById( "cidades_" + array_cidades[i].id_estado ).appendChild( cidade );
					}
                   
                }
                
                /* Botão para voltar de cidade para estados*/
                var back_button = document.createElement( "a" );
                var back_button_txt = document.createTextNode( "Volta" );
                    
                back_button.appendChild( back_button_txt );
                    
                back_button.className = "botao_volta";
                back_button.setAttribute( "data-role", "button" );
                    
                back_button.href = "#box_estados_pg";
                    
                document.getElementById( "cidades_" + estados[x].id_estado ).appendChild( back_button );
                
                /*------*/
                
        		document.getElementById( "estado_" + estados[x].id_estado ).href = "#cidades_box_" + estados[x].id_estado ;
                        
                cidades = array_cidades;
            }
        };
        
        /*Função pra receber o json do servidor*/
        function praias_receiver( array_praias )
        {
            for ( var x = 0 ; x < cidades.length; x++ )
            {
             	var page = document.createElement( "div" );
                var page_header_div = document.createElement( "div" );
                var page_content = document.createElement( "div" );
                var page_footer_div = document.createElement( "div" );
                var page_header = document.createElement( "header" );
                var page_footer = document.createElement( "header" );
                var page_footer_txt = document.createTextNode( "Surfer 2 Surfer" );
				var page_header_txt = document.createTextNode( cidades[x].nome_cidade );
                
                page.appendChild( page_header_div );
                page.appendChild( page_content );
                page.appendChild( page_footer_div );
                page_header_div.appendChild( page_header );
                page_footer_div.appendChild( page_footer );
                page_footer.appendChild( page_footer_txt );
				page_header.appendChild( page_header_txt );
                
                page.setAttribute( "data-role", "page" );
                page.setAttribute( "id", "praias_box_" + cidades[x].id_cidade  );
                page_content.setAttribute( "data-role", "content" );
                page_content.setAttribute( "id", "praias_" + cidades[x].id_cidade );
                page_header_div.setAttribute( "data-role", "header" );
                page_footer_div.setAttribute( "data-role", "header" );
            
                document.body.appendChild( page ); 
                
                for ( var i = 0; i < array_praias.length; i++ )
                { 
					if( array_praias[i].id_cidade > cidades[x].id_cidade )
					{
                        break;
					}
					
					else if( array_praias[i].id_cidade < cidades[x].id_cidade )
					{
						continue;
					}
					
					else
					{
						var praia = document.createElement( "a" );
                        var praia_grid = document.createElement( "div" );
                        var praia_block = document.createElement( "div" );
                        var nota_block = document.createElement( "div" );
                        var nota_1_txt = document.createElement( "p" );
                        var nota_1_node = document.createTextNode ( "Teste Grid" );
                        
						var praia_txt = document.createTextNode( array_praias[i].nome_praia );
                        var comment_area = document.createElement( "textarea" );
                        var comment_box = document.createElement( "div" );
                        var comment_submit = document.createElement( "button" );
                        var comment_submit_txt = document.createTextNode ( "Submit Comment" );
                        
                        var notas_box = document.createElement( "fieldset" );
						var nota_legenda = document.createElement( "legend" );
						var nota_legenda_txt = document.createTextNode ( "De uma nota a essa praia" );
						
						nota_legenda.appendChild( nota_legenda_txt );
						notas_box.appendChild( nota_legenda );
						
                        for ( var nota = 0 ; nota < notas.length; nota++ )
                        {
                            var nota_radio = document.createElement( "input" );		
							var nota_label = document.createElement ( "label" );
							var nota_txt = document.createTextNode( notas[nota].texto_nota );
                            nota_radio.setAttribute( "name", "nota" );
							nota_radio.setAttribute( "type", "radio" );
							nota_radio.setAttribute( "data-theme", "a" );
                            nota_radio.setAttribute( "class", "nota_" + notas[nota].id_nota );
							nota_radio.setAttribute( "id", "nota_" + array_praias[i].id_praia + "_" + notas[nota].id_nota );
                            nota_radio.setAttribute( "value", notas[nota].id_nota );
							
							nota_label.setAttribute( "for", "nota_" + array_praias[i].id_praia + "_" + notas[nota].id_nota );
							nota_label.appendChild( nota_txt );
                           
						    nota_label.style.color = notas[nota].cor_nota;
                            notas_box.appendChild( nota_radio );
							notas_box.appendChild( nota_label );
                        }
                        
                        /* -- montagem do grid --*/
                        praia_grid.className = "ui-grid-a";
                        praia_grid.setAttribute( "id", "praia_grid_" + array_praias[i].id_praia );
                        
                        praia_block.className = "ui-block-a";
                        praia_block.setAttribute( "id", "praia_block_" + array_praias[i].id_praia );
                        
                        nota_block.className = "ui-block-b";
                        nota_block.setAttribute( "id", "nota_block_" + array_praias[i].id_praia );
                        /* -- */
                        
                        
                        /* praia e div de comentários */
						notas_box.setAttribute( "data-role", "controlgroup" );				
						notas_box.setAttribute( "id", "nota_box_" + array_praias[i].id_praia  );
						notas_box.className = "nota_box" ;
                                                
						praia.appendChild( praia_txt );
                        comment_submit.appendChild( comment_submit_txt );
                        comment_box.appendChild( notas_box );
                        comment_box.appendChild( comment_area );
                        comment_box.appendChild( comment_submit );
		 
						praia.className = "praia";
                        comment_box.className = "comment_box";
                        comment_area.className = "comment_area";
                        comment_submit.className = "comment_submit";
                      						
                        praia.setAttribute( "data-role", "button" );
                        praia.setAttribute( "id", "praia_" + array_praias[i].id_praia );
                        comment_box.setAttribute( "id", "comment_box_" + array_praias[i].id_praia );
                        comment_area.setAttribute( "id", "comment_area_" + array_praias[i].id_praia );
                        comment_submit.setAttribute( "id", "comment_submit_" + array_praias[i].id_praia );
                        /* -- */
                        
                        nota_1_txt.appendChild( nota_1_node );
                        
                        praia_block.appendChild( praia );
                        nota_block.appendChild( nota_1_txt );
                        
                        praia_grid.appendChild( praia_block );
                        praia_grid.appendChild( nota_block );
                        
						document.getElementById( "praias_" + array_praias[i].id_cidade ).appendChild( praia_grid );
                        document.getElementById( "praias_" + array_praias[i].id_cidade ).appendChild( comment_box );
					}
                   
                }
                
                /* Botão para voltar de cidade para estados*/
                var back_button = document.createElement( "a" );
                var back_button_txt = document.createTextNode( "Volta" );
                    
                back_button.appendChild( back_button_txt );
                    
                back_button.className = "botao_volta";
                back_button.setAttribute( "data-role", "button" );
                    
                back_button.href = "#cidades_box_" + cidades[x].id_estado;
                    
                document.getElementById( "praias_" + cidades[x].id_cidade ).appendChild( back_button );
                
                /*------*/
                
        		document.getElementById( "cidade_" + cidades[x].id_cidade ).href = "#praias_box_" + cidades[x].id_cidade ;
            }
        };
        
        /* Quando o documento der load */
        $( document ).ready(
        	function( )
            {
                
               $( ".comment_box" ).hide( ); 
                
               $( ".praia" ).click(
                   function ( )
                   {
                       var id_full = $( this ).attr( 'id' );
                       var id_ind =  id_full.indexOf( '_' ) + 1 ;
                       var id = id_full.substr( id_ind );
                       var com_str = "comment_box_";
                       
                       $( "#" + com_str + id ).toggle( );
                       
                   }
               
               );
                
               $( ".praia" ).dblclick(
                   function ( )
                   {
                       var id_full = $( this ).attr( 'id' );
                       var id_ind =  id_full.indexOf( '_' ) + 1 ;
                       var id = id_full.substr( id_ind );
                       var com_str = "comment_box_";
                       
                       $( "#" + com_str + id ).toggle( );
                       alert( "Sexo animal" );
                       
                   }
               
               );
                
               $( ".comment_submit" ).click(
                   function ( )
                   {
                       var id_full = $( this ).attr( 'id' );
                       var id_ind =  id_full.lastIndexOf( '_' ) + 1 ;
                       var id = id_full.substr( id_ind );
                       var com_str_area = "comment_area_";
                       var json_array = 
                           [
                               { 	"comment_val" : $("#" + com_str_area + id).val( ) ,
                               		"praia_id"	: id,
									"nota_id" : $("input[name*=nota]:checked").val( )
                               }
                       	   ];
                       var json_str = JSON.stringify( json_array );
                       
                       request = new XMLHttpRequest( );
                       request.open( "POST", "http://surfer2surfer.com.br/json_handler_comment.php" );
                       request.setRequestHeader( "Content-type", "application/json", true );
                       request.send( json_str );
                   }
               
               ); 
                
            }
        );
 
    </script>
    <script src="http://surfer2surfer.com.br/json_estados.php?callback=estados_receiver"></script>
    <script src="http://surfer2surfer.com.br/json_notas.php?callback=notas_receiver"></script>
    <script src="http://surfer2surfer.com.br/json_cidades.php?callback=cidades_receiver"></script>
    <script src="http://surfer2surfer.com.br/json_praias.php?callback=praias_receiver"></script>
    
</body>
</html>
